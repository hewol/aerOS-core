#!/bin/sh

# Get the root directory
ROOT=$1

# Take a backup and change to a temporary directory
cp $ROOT/boot/grub/grub.cfg $ROOT/boot/grub/grub.cfg.bak
cd /tmp

# Remove advanced options
sed -i "109,127d" $ROOT/boot/grub/grub.cfg

# Save boot option syntax
sed -n "92,108p" $ROOT/boot/grub/grub.cfg > boot.option

# Copy the boot options
sed -i "109r boot.option" $ROOT/boot/grub/grub.cfg
sed -i "127r boot.option" $ROOT/boot/grub/grub.cfg

# Rename the boot options
sed -i "92s/aerOS Core Linux/aerOS Core/g" $ROOT/boot/grub/grub.cfg
sed -i "110s/aerOS Core Linux/aerOS Core with safe graphics driver/g" $ROOT/boot/grub/grub.cfg
sed -i "128s/aerOS Core Linux/aerOS Core in TTY mode/g" $ROOT/boot/grub/grub.cfg

# Change kernel parameters for newly created boot options
sed -i "123s/quiet splash/quiet splash nomodeset/g" $ROOT/boot/grub/grub.cfg
sed -i "141s/quiet splash loglevel=3/loglevel=3 \$vt_handoff 3/g" $ROOT/boot/grub/grub.cfg
